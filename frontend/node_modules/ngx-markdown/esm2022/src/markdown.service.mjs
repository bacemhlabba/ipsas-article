import { isPlatformBrowser } from '@angular/common';
import { Inject, Injectable, InjectionToken, Optional, PLATFORM_ID, } from '@angular/core';
// eslint-disable-next-line import/named
import { marked, Renderer } from 'marked';
import { Subject } from 'rxjs';
import { map } from 'rxjs/operators';
import { ClipboardButtonComponent } from './clipboard-button.component';
import { CLIPBOARD_OPTIONS } from './clipboard-options';
import { MARKED_EXTENSIONS } from './marked-extensions';
import { MARKED_OPTIONS } from './marked-options';
import { MarkedRenderer } from './marked-renderer';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
import * as i2 from "@angular/platform-browser";
/* eslint-disable max-len */
export const errorJoyPixelsNotLoaded = '[ngx-markdown] When using the `emoji` attribute you *have to* include Emoji-Toolkit files to `angular.json` or use imports. See README for more information';
export const errorKatexNotLoaded = '[ngx-markdown] When using the `katex` attribute you *have to* include KaTeX files to `angular.json` or use imports. See README for more information';
export const errorMermaidNotLoaded = '[ngx-markdown] When using the `mermaid` attribute you *have to* include Mermaid files to `angular.json` or use imports. See README for more information';
export const errorClipboardNotLoaded = '[ngx-markdown] When using the `clipboard` attribute you *have to* include Clipboard files to `angular.json` or use imports. See README for more information';
export const errorClipboardViewContainerRequired = '[ngx-markdown] When using the `clipboard` attribute you *have to* provide the `viewContainerRef` parameter to `MarkdownService.render()` function';
export const errorSrcWithoutHttpClient = '[ngx-markdown] When using the `src` attribute you *have to* pass the `HttpClient` as a parameter of the `forRoot` method. See README for more information';
/* eslint-enable max-len */
export const SECURITY_CONTEXT = new InjectionToken('SECURITY_CONTEXT');
export class ExtendedRenderer extends Renderer {
    constructor() {
        super(...arguments);
        this.ɵNgxMarkdownRendererExtendedForExtensions = false;
        this.ɵNgxMarkdownRendererExtendedForMermaid = false;
    }
}
export class MarkdownService {
    get options() { return this._options; }
    set options(value) {
        this._options = { ...this.DEFAULT_MARKED_OPTIONS, ...value };
    }
    get renderer() { return this.options.renderer; }
    set renderer(value) {
        this.options.renderer = value;
    }
    constructor(clipboardOptions, extensions, options, platform, securityContext, http, sanitizer) {
        this.clipboardOptions = clipboardOptions;
        this.extensions = extensions;
        this.platform = platform;
        this.securityContext = securityContext;
        this.http = http;
        this.sanitizer = sanitizer;
        this.DEFAULT_MARKED_OPTIONS = {
            renderer: new MarkedRenderer(),
        };
        this.DEFAULT_KATEX_OPTIONS = {
            delimiters: [
                { left: '$$', right: '$$', display: true },
                { left: '$', right: '$', display: false },
                { left: '\\(', right: '\\)', display: false },
                { left: '\\begin{equation}', right: '\\end{equation}', display: true },
                { left: '\\begin{align}', right: '\\end{align}', display: true },
                { left: '\\begin{alignat}', right: '\\end{alignat}', display: true },
                { left: '\\begin{gather}', right: '\\end{gather}', display: true },
                { left: '\\begin{CD}', right: '\\end{CD}', display: true },
                { left: '\\[', right: '\\]', display: true },
            ],
        };
        this.DEFAULT_MERMAID_OPTIONS = {
            startOnLoad: false,
        };
        this.DEFAULT_CLIPBOARD_OPTIONS = {
            buttonComponent: undefined,
        };
        this.DEFAULT_PARSE_OPTIONS = {
            decodeHtml: false,
            inline: false,
            emoji: false,
            mermaid: false,
            markedOptions: undefined,
            disableSanitizer: false,
        };
        this.DEFAULT_RENDER_OPTIONS = {
            clipboard: false,
            clipboardOptions: undefined,
            katex: false,
            katexOptions: undefined,
            mermaid: false,
            mermaidOptions: undefined,
        };
        this._reload$ = new Subject();
        this.reload$ = this._reload$.asObservable();
        this.options = options;
    }
    parse(markdown, parseOptions = this.DEFAULT_PARSE_OPTIONS) {
        const { decodeHtml, inline, emoji, mermaid, disableSanitizer, } = parseOptions;
        const markedOptions = {
            ...this.options,
            ...parseOptions.markedOptions,
        };
        const renderer = markedOptions.renderer || this.renderer || new Renderer();
        if (this.extensions) {
            this.renderer = this.extendsRendererForExtensions(renderer);
        }
        if (mermaid) {
            this.renderer = this.extendsRendererForMermaid(renderer);
        }
        const trimmed = this.trimIndentation(markdown);
        const decoded = decodeHtml ? this.decodeHtml(trimmed) : trimmed;
        const emojified = emoji ? this.parseEmoji(decoded) : decoded;
        const marked = this.parseMarked(emojified, markedOptions, inline);
        const sanitized = disableSanitizer ? marked : this.sanitizer.sanitize(this.securityContext, marked);
        return sanitized || '';
    }
    render(element, options = this.DEFAULT_RENDER_OPTIONS, viewContainerRef) {
        const { clipboard, clipboardOptions, katex, katexOptions, mermaid, mermaidOptions, } = options;
        if (katex) {
            this.renderKatex(element, {
                ...this.DEFAULT_KATEX_OPTIONS,
                ...katexOptions,
            });
        }
        if (mermaid) {
            this.renderMermaid(element, {
                ...this.DEFAULT_MERMAID_OPTIONS,
                ...mermaidOptions,
            });
        }
        if (clipboard) {
            this.renderClipboard(element, viewContainerRef, {
                ...this.DEFAULT_CLIPBOARD_OPTIONS,
                ...this.clipboardOptions,
                ...clipboardOptions,
            });
        }
        this.highlight(element);
    }
    reload() {
        this._reload$.next();
    }
    getSource(src) {
        if (!this.http) {
            throw new Error(errorSrcWithoutHttpClient);
        }
        return this.http
            .get(src, { responseType: 'text' })
            .pipe(map(markdown => this.handleExtension(src, markdown)));
    }
    highlight(element) {
        if (!isPlatformBrowser(this.platform)) {
            return;
        }
        if (typeof Prism === 'undefined' || typeof Prism.highlightAllUnder === 'undefined') {
            return;
        }
        if (!element) {
            element = document;
        }
        const noLanguageElements = element.querySelectorAll('pre code:not([class*="language-"])');
        Array.prototype.forEach.call(noLanguageElements, (x) => x.classList.add('language-none'));
        Prism.highlightAllUnder(element);
    }
    decodeHtml(html) {
        if (!isPlatformBrowser(this.platform)) {
            return html;
        }
        const textarea = document.createElement('textarea');
        textarea.innerHTML = html;
        return textarea.value;
    }
    extendsRendererForExtensions(renderer) {
        const extendedRenderer = renderer;
        if (extendedRenderer.ɵNgxMarkdownRendererExtendedForExtensions === true) {
            return renderer;
        }
        if (this.extensions?.length > 0) {
            marked.use(...this.extensions);
        }
        extendedRenderer.ɵNgxMarkdownRendererExtendedForExtensions = true;
        return renderer;
    }
    extendsRendererForMermaid(renderer) {
        const extendedRenderer = renderer;
        if (extendedRenderer.ɵNgxMarkdownRendererExtendedForMermaid === true) {
            return renderer;
        }
        // eslint-disable-next-line @typescript-eslint/unbound-method
        const defaultCode = renderer.code;
        renderer.code = function (code, language, isEscaped) {
            return language === 'mermaid'
                ? `<div class="mermaid">${code}</div>`
                : defaultCode.call(this, code, language, isEscaped);
        };
        extendedRenderer.ɵNgxMarkdownRendererExtendedForMermaid = true;
        return renderer;
    }
    handleExtension(src, markdown) {
        const urlProtocolIndex = src.lastIndexOf('://');
        const urlWithoutProtocol = urlProtocolIndex > -1
            ? src.substring(urlProtocolIndex + 4)
            : src;
        const lastSlashIndex = urlWithoutProtocol.lastIndexOf('/');
        const lastUrlSegment = lastSlashIndex > -1
            ? urlWithoutProtocol.substring(lastSlashIndex + 1).split('?')[0]
            : '';
        const lastDotIndex = lastUrlSegment.lastIndexOf('.');
        const extension = lastDotIndex > -1
            ? lastUrlSegment.substring(lastDotIndex + 1)
            : '';
        return !!extension && extension !== 'md'
            ? '```' + extension + '\n' + markdown + '\n```'
            : markdown;
    }
    parseMarked(html, markedOptions, inline = false) {
        if (markedOptions.renderer) {
            // clone renderer and remove extended flags otherwise
            // marked throws an error thinking it is a renderer prop
            const renderer = { ...markedOptions.renderer };
            delete renderer.ɵNgxMarkdownRendererExtendedForExtensions;
            delete renderer.ɵNgxMarkdownRendererExtendedForMermaid;
            // remove renderer from markedOptions because if renderer is
            // passed to marked.parse method, it will ignore all extensions
            delete markedOptions.renderer;
            marked.use({ renderer });
        }
        return inline
            ? marked.parseInline(html, markedOptions)
            : marked.parse(html, markedOptions);
    }
    parseEmoji(html) {
        if (!isPlatformBrowser(this.platform)) {
            return html;
        }
        if (typeof joypixels === 'undefined' || typeof joypixels.shortnameToUnicode === 'undefined') {
            throw new Error(errorJoyPixelsNotLoaded);
        }
        return joypixels.shortnameToUnicode(html);
    }
    renderKatex(element, options) {
        if (!isPlatformBrowser(this.platform)) {
            return;
        }
        if (typeof katex === 'undefined' || typeof renderMathInElement === 'undefined') {
            throw new Error(errorKatexNotLoaded);
        }
        renderMathInElement(element, options);
    }
    renderClipboard(element, viewContainerRef, options) {
        if (!isPlatformBrowser(this.platform)) {
            return;
        }
        if (typeof ClipboardJS === 'undefined') {
            throw new Error(errorClipboardNotLoaded);
        }
        if (!viewContainerRef) {
            throw new Error(errorClipboardViewContainerRequired);
        }
        const { buttonComponent, buttonTemplate, } = options;
        // target every <pre> elements
        const preElements = element.querySelectorAll('pre');
        for (let i = 0; i < preElements.length; i++) {
            const preElement = preElements.item(i);
            // create <pre> wrapper element
            const preWrapperElement = document.createElement('div');
            preWrapperElement.style.position = 'relative';
            preElement.parentNode.insertBefore(preWrapperElement, preElement);
            preWrapperElement.appendChild(preElement);
            // create toolbar element
            const toolbarWrapperElement = document.createElement('div');
            toolbarWrapperElement.classList.add('markdown-clipboard-toolbar');
            toolbarWrapperElement.style.position = 'absolute';
            toolbarWrapperElement.style.top = '.5em';
            toolbarWrapperElement.style.right = '.5em';
            toolbarWrapperElement.style.zIndex = '1';
            preWrapperElement.insertAdjacentElement('beforeend', toolbarWrapperElement);
            // register listener to show/hide toolbar
            preWrapperElement.onmouseenter = () => toolbarWrapperElement.classList.add('hover');
            preWrapperElement.onmouseleave = () => toolbarWrapperElement.classList.remove('hover');
            // declare embeddedViewRef holding variable
            let embeddedViewRef;
            // use provided component via input property
            // or provided via ClipboardOptions provider
            if (buttonComponent) {
                const componentRef = viewContainerRef.createComponent(buttonComponent);
                embeddedViewRef = componentRef.hostView;
                componentRef.changeDetectorRef.markForCheck();
            }
            // use provided template via input property
            else if (buttonTemplate) {
                embeddedViewRef = viewContainerRef.createEmbeddedView(buttonTemplate);
            }
            // use default component
            else {
                const componentRef = viewContainerRef.createComponent(ClipboardButtonComponent);
                embeddedViewRef = componentRef.hostView;
                componentRef.changeDetectorRef.markForCheck();
            }
            // declare clipboard instance variable
            let clipboardInstance;
            // attach clipboard.js to root node
            embeddedViewRef.rootNodes.forEach((node) => {
                toolbarWrapperElement.appendChild(node);
                clipboardInstance = new ClipboardJS(node, { text: () => preElement.innerText });
            });
            // destroy clipboard instance when view is destroyed
            embeddedViewRef.onDestroy(() => clipboardInstance.destroy());
        }
    }
    renderMermaid(element, options = this.DEFAULT_MERMAID_OPTIONS) {
        if (!isPlatformBrowser(this.platform)) {
            return;
        }
        if (typeof mermaid === 'undefined' || typeof mermaid.initialize === 'undefined') {
            throw new Error(errorMermaidNotLoaded);
        }
        const mermaidElements = element.querySelectorAll('.mermaid');
        if (mermaidElements.length === 0) {
            return;
        }
        mermaid.initialize(options);
        mermaid.run({ nodes: mermaidElements });
    }
    trimIndentation(markdown) {
        if (!markdown) {
            return '';
        }
        let indentStart;
        return markdown
            .split('\n')
            .map(line => {
            let lineIdentStart = indentStart;
            if (line.length > 0) {
                lineIdentStart = isNaN(lineIdentStart)
                    ? line.search(/\S|$/)
                    : Math.min(line.search(/\S|$/), lineIdentStart);
            }
            if (isNaN(indentStart)) {
                indentStart = lineIdentStart;
            }
            return lineIdentStart
                ? line.substring(lineIdentStart)
                : line;
        }).join('\n');
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.6", ngImport: i0, type: MarkdownService, deps: [{ token: CLIPBOARD_OPTIONS, optional: true }, { token: MARKED_EXTENSIONS, optional: true }, { token: MARKED_OPTIONS, optional: true }, { token: PLATFORM_ID }, { token: SECURITY_CONTEXT }, { token: i1.HttpClient, optional: true }, { token: i2.DomSanitizer }], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "18.2.6", ngImport: i0, type: MarkdownService }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.6", ngImport: i0, type: MarkdownService, decorators: [{
            type: Injectable
        }], ctorParameters: () => [{ type: undefined, decorators: [{
                    type: Inject,
                    args: [CLIPBOARD_OPTIONS]
                }, {
                    type: Optional
                }] }, { type: undefined, decorators: [{
                    type: Inject,
                    args: [MARKED_EXTENSIONS]
                }, {
                    type: Optional
                }] }, { type: undefined, decorators: [{
                    type: Inject,
                    args: [MARKED_OPTIONS]
                }, {
                    type: Optional
                }] }, { type: Object, decorators: [{
                    type: Inject,
                    args: [PLATFORM_ID]
                }] }, { type: i0.SecurityContext, decorators: [{
                    type: Inject,
                    args: [SECURITY_CONTEXT]
                }] }, { type: i1.HttpClient, decorators: [{
                    type: Optional
                }] }, { type: i2.DomSanitizer }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFya2Rvd24uc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2xpYi9zcmMvbWFya2Rvd24uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUVwRCxPQUFPLEVBRUwsTUFBTSxFQUNOLFVBQVUsRUFDVixjQUFjLEVBQ2QsUUFBUSxFQUNSLFdBQVcsR0FHWixNQUFNLGVBQWUsQ0FBQztBQUV2Qix3Q0FBd0M7QUFDeEMsT0FBTyxFQUFFLE1BQU0sRUFBbUIsUUFBUSxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBQzNELE9BQU8sRUFBYyxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDM0MsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JDLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQ3hFLE9BQU8sRUFBRSxpQkFBaUIsRUFBNEMsTUFBTSxxQkFBcUIsQ0FBQztBQUVsRyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsY0FBYyxFQUFpQixNQUFNLGtCQUFrQixDQUFDO0FBQ2pFLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQzs7OztBQWdDbkQsNEJBQTRCO0FBQzVCLE1BQU0sQ0FBQyxNQUFNLHVCQUF1QixHQUFHLDZKQUE2SixDQUFDO0FBQ3JNLE1BQU0sQ0FBQyxNQUFNLG1CQUFtQixHQUFHLHFKQUFxSixDQUFDO0FBQ3pMLE1BQU0sQ0FBQyxNQUFNLHFCQUFxQixHQUFHLHlKQUF5SixDQUFDO0FBQy9MLE1BQU0sQ0FBQyxNQUFNLHVCQUF1QixHQUFHLDZKQUE2SixDQUFDO0FBQ3JNLE1BQU0sQ0FBQyxNQUFNLG1DQUFtQyxHQUFHLG1KQUFtSixDQUFDO0FBQ3ZNLE1BQU0sQ0FBQyxNQUFNLHlCQUF5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RCxPQUFPLGNBQWM7Z0JBQ25CLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQztnQkFDaEMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUNYLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNsQixDQUFDOzhHQTlYVSxlQUFlLGtCQThEaEIsaUJBQWlCLDZCQUNqQixpQkFBaUIsNkJBQ2pCLGNBQWMsNkJBQ2QsV0FBVyxhQUNYLGdCQUFnQjtrSEFsRWYsZUFBZTs7MkZBQWYsZUFBZTtrQkFEM0IsVUFBVTs7MEJBK0ROLE1BQU07MkJBQUMsaUJBQWlCOzswQkFBRyxRQUFROzswQkFDbkMsTUFBTTsyQkFBQyxpQkFBaUI7OzBCQUFHLFFBQVE7OzBCQUNuQyxNQUFNOzJCQUFDLGNBQWM7OzBCQUFHLFFBQVE7OzBCQUNoQyxNQUFNOzJCQUFDLFdBQVc7OzBCQUNsQixNQUFNOzJCQUFDLGdCQUFnQjs7MEJBQ3ZCLFFBQVEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpc1BsYXRmb3JtQnJvd3NlciB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XHJcbmltcG9ydCB7IEh0dHBDbGllbnQgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XHJcbmltcG9ydCB7XHJcbiAgRW1iZWRkZWRWaWV3UmVmLFxyXG4gIEluamVjdCxcclxuICBJbmplY3RhYmxlLFxyXG4gIEluamVjdGlvblRva2VuLFxyXG4gIE9wdGlvbmFsLFxyXG4gIFBMQVRGT1JNX0lELFxyXG4gIFNlY3VyaXR5Q29udGV4dCxcclxuICBWaWV3Q29udGFpbmVyUmVmLFxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBEb21TYW5pdGl6ZXIgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyJztcclxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGltcG9ydC9uYW1lZFxyXG5pbXBvcnQgeyBtYXJrZWQsIE1hcmtlZEV4dGVuc2lvbiwgUmVuZGVyZXIgfSBmcm9tICdtYXJrZWQnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IHsgQ2xpcGJvYXJkQnV0dG9uQ29tcG9uZW50IH0gZnJvbSAnLi9jbGlwYm9hcmQtYnV0dG9uLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IENMSVBCT0FSRF9PUFRJT05TLCBDbGlwYm9hcmRPcHRpb25zLCBDbGlwYm9hcmRSZW5kZXJPcHRpb25zIH0gZnJvbSAnLi9jbGlwYm9hcmQtb3B0aW9ucyc7XHJcbmltcG9ydCB7IEthdGV4T3B0aW9ucyB9IGZyb20gJy4va2F0ZXgtb3B0aW9ucyc7XHJcbmltcG9ydCB7IE1BUktFRF9FWFRFTlNJT05TIH0gZnJvbSAnLi9tYXJrZWQtZXh0ZW5zaW9ucyc7XHJcbmltcG9ydCB7IE1BUktFRF9PUFRJT05TLCBNYXJrZWRPcHRpb25zIH0gZnJvbSAnLi9tYXJrZWQtb3B0aW9ucyc7XHJcbmltcG9ydCB7IE1hcmtlZFJlbmRlcmVyIH0gZnJvbSAnLi9tYXJrZWQtcmVuZGVyZXInO1xyXG5pbXBvcnQgeyBNZXJtYWlkQVBJIH0gZnJvbSAnLi9tZXJtYWlkLW9wdGlvbnMnO1xyXG5cclxuLy8gY2xpcGJvYXJkXHJcbmRlY2xhcmUgbGV0IENsaXBib2FyZEpTOiB7XHJcbiAgbmV3KFxyXG4gICAgc2VsZWN0b3I6IHN0cmluZyB8IEVsZW1lbnQgfCBOb2RlTGlzdE9mPEVsZW1lbnQ+LFxyXG4gICAgb3B0aW9ucz86IHsgdGV4dD86IChlbGVtOiBFbGVtZW50KSA9PiBzdHJpbmcgfSxcclxuICApOiB0eXBlb2YgQ2xpcGJvYXJkSlM7XHJcbiAgZGVzdHJveSgpOiB2b2lkO1xyXG59O1xyXG5cclxuLy8gZW1vamlcclxuZGVjbGFyZSBsZXQgam95cGl4ZWxzOiB7XHJcbiAgc2hvcnRuYW1lVG9Vbmljb2RlKGlucHV0OiBzdHJpbmcpOiBzdHJpbmc7XHJcbn07XHJcblxyXG4vLyBrYXRleFxyXG5kZWNsYXJlIGxldCBrYXRleDogdW5rbm93bjtcclxuZGVjbGFyZSBmdW5jdGlvbiByZW5kZXJNYXRoSW5FbGVtZW50KGVsZW06IEhUTUxFbGVtZW50LCBvcHRpb25zPzogS2F0ZXhPcHRpb25zKTogdm9pZDtcclxuXHJcbi8vIG1lcm1haWRcclxuZGVjbGFyZSBsZXQgbWVybWFpZDoge1xyXG4gIGluaXRpYWxpemU6IChvcHRpb25zOiBNZXJtYWlkQVBJLkNvbmZpZykgPT4gdm9pZDtcclxuICBydW46IChydW5PcHRpb25zOiBNZXJtYWlkQVBJLlJ1bk9wdGlvbnMpID0+IHZvaWQ7XHJcbn07XHJcblxyXG4vLyBwcmlzbVxyXG5kZWNsYXJlIGxldCBQcmlzbToge1xyXG4gIGhpZ2hsaWdodEFsbFVuZGVyOiAoZWxlbWVudDogRWxlbWVudCB8IERvY3VtZW50KSA9PiB2b2lkO1xyXG59O1xyXG5cclxuLyogZXNsaW50LWRpc2FibGUgbWF4LWxlbiAqL1xyXG5leHBvcnQgY29uc3QgZXJyb3JKb3lQaXhlbHNOb3RMb2FkZWQgPSAnW25neC1tYXJrZG93bl0gV2hlbiB1c2luZyB0aGUgYGVtb2ppYCBhdHRyaWJ1dGUgeW91ICpoYXZlIHRvKiBpbmNsdWRlIEVtb2ppLVRvb2xraXQgZmlsZXMgdG8gYGFuZ3VsYXIuanNvbmAgb3IgdXNlIGltcG9ydHMuIFNlZSBSRUFETUUgZm9yIG1vcmUgaW5mb3JtYXRpb24nO1xyXG5leHBvcnQgY29uc3QgZXJyb3JLYXRleE5vdExvYWRlZCA9ICdbbmd4LW1hcmtkb3duXSBXaGVuIHVzaW5nIHRoZSBga2F0ZXhgIGF0dHJpYnV0ZSB5b3UgKmhhdmUgdG8qIGluY2x1ZGUgS2FUZVggZmlsZXMgdG8gYGFuZ3VsYXIuanNvbmAgb3IgdXNlIGltcG9ydHMuIFNlZSBSRUFETUUgZm9yIG1vcmUgaW5mb3JtYXRpb24nO1xyXG5leHBvcnQgY29uc3QgZXJyb3JNZXJtYWlkTm90TG9hZGVkID0gJ1tuZ3gtbWFya2Rvd25dIFdoZW4gdXNpbmcgdGhlIGBtZXJtYWlkYCBhdHRyaWJ1dGUgeW91ICpoYXZlIHRvKiBpbmNsdWRlIE1lcm1haWQgZmlsZXMgdG8gYGFuZ3VsYXIuanNvbmAgb3IgdXNlIGltcG9ydHMuIFNlZSBSRUFETUUgZm9yIG1vcmUgaW5mb3JtYXRpb24nO1xyXG5leHBvcnQgY29uc3QgZXJyb3JDbGlwYm9hcmROb3RMb2FkZWQgPSAnW25neC1tYXJrZG93bl0gV2hlbiB1c2luZyB0aGUgYGNsaXBib2FyZGAgYXR0cmlidXRlIHlvdSAqaGF2ZSB0byogaW5jbHVkZSBDbGlwYm9hcmQgZmlsZXMgdG8gYGFuZ3VsYXIuanNvbmAgb3IgdXNlIGltcG9ydHMuIFNlZSBSRUFETUUgZm9yIG1vcmUgaW5mb3JtYXRpb24nO1xyXG5leHBvcnQgY29uc3QgZXJyb3JDbGlwYm9hcmRWaWV3Q29udGFpbmVyUmVxdWlyZWQgPSAnW25neC1tYXJrZG93bl0gV2hlbiB1c2luZyB0aGUgYGNsaXBib2FyZGAgYXR0cmlidXRlIHlvdSAqaGF2ZSB0byogcHJvdmlkZSB0aGUgYHZpZXdDb250YWluZXJSZWZgIHBhcmFtZXRlciB0byBgTWFya2Rvd25TZXJ2aWNlLnJlbmRlcigpYCBmdW5jdGlvbic7XHJcbmV4cG9ydCBjb25zdCBlcnJvclNyY1dpdGhvdXRIdHRwQ2xpZW50ID0gJ1tuZ3gtbWFya2Rvd25dIFdoZW4gdXNpbmcgdGhlIGBzcmNgIGF0dHJpYnV0ZSB5b3UgKmhhdmUgdG8qIHBhc3MgdGhlIGBIdHRwQ2xpZW50YCBhcyBhIHBhcmFtZXRlciBvZiB0aGUgYGZvclJvb3RgIG1ldGhvZC4gU2VlIFJFQURNRSBmb3IgbW9yZSBpbmZvcm1hdGlvbic7XHJcbi8qIGVzbGludC1lbmFibGUgbWF4LWxlbiAqL1xyXG5cclxuZXhwb3J0IGNvbnN0IFNFQ1VSSVRZX0NPTlRFWFQgPSBuZXcgSW5qZWN0aW9uVG9rZW48U2VjdXJpdHlDb250ZXh0PignU0VDVVJJVFlfQ09OVEVYVCcpO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBQYXJzZU9wdGlvbnMge1xyXG4gIGRlY29kZUh0bWw/OiBib29sZWFuO1xyXG4gIGlubGluZT86IGJvb2xlYW47XHJcbiAgZW1vamk/OiBib29sZWFuO1xyXG4gIG1lcm1haWQ/OiBib29sZWFuO1xyXG4gIG1hcmtlZE9wdGlvbnM/OiBNYXJrZWRPcHRpb25zO1xyXG4gIGRpc2FibGVTYW5pdGl6ZXI/OiBib29sZWFuO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFJlbmRlck9wdGlvbnMge1xyXG4gIGNsaXBib2FyZD86IGJvb2xlYW47XHJcbiAgY2xpcGJvYXJkT3B0aW9ucz86IENsaXBib2FyZFJlbmRlck9wdGlvbnM7XHJcbiAga2F0ZXg/OiBib29sZWFuO1xyXG4gIGthdGV4T3B0aW9ucz86IEthdGV4T3B0aW9ucztcclxuICBtZXJtYWlkPzogYm9vbGVhbjtcclxuICBtZXJtYWlkT3B0aW9ucz86IE1lcm1haWRBUEkuQ29uZmlnO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgRXh0ZW5kZWRSZW5kZXJlciBleHRlbmRzIFJlbmRlcmVyIHtcclxuICDJtU5neE1hcmtkb3duUmVuZGVyZXJFeHRlbmRlZEZvckV4dGVuc2lvbnMgPSBmYWxzZTtcclxuICDJtU5neE1hcmtkb3duUmVuZGVyZXJFeHRlbmRlZEZvck1lcm1haWQgPSBmYWxzZTtcclxufVxyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgTWFya2Rvd25TZXJ2aWNlIHtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBERUZBVUxUX01BUktFRF9PUFRJT05TOiBNYXJrZWRPcHRpb25zID0ge1xyXG4gICAgcmVuZGVyZXI6IG5ldyBNYXJrZWRSZW5kZXJlcigpLFxyXG4gIH07XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgREVGQVVMVF9LQVRFWF9PUFRJT05TOiBLYXRleE9wdGlvbnMgPSB7XHJcbiAgICBkZWxpbWl0ZXJzOiBbXHJcbiAgICAgIHsgbGVmdDogJyQkJywgcmlnaHQ6ICckJCcsIGRpc3BsYXk6IHRydWUgfSxcclxuICAgICAgeyBsZWZ0OiAnJCcsIHJpZ2h0OiAnJCcsIGRpc3BsYXk6IGZhbHNlIH0sXHJcbiAgICAgIHsgbGVmdDogJ1xcXFwoJywgcmlnaHQ6ICdcXFxcKScsIGRpc3BsYXk6IGZhbHNlIH0sXHJcbiAgICAgIHsgbGVmdDogJ1xcXFxiZWdpbntlcXVhdGlvbn0nLCByaWdodDogJ1xcXFxlbmR7ZXF1YXRpb259JywgZGlzcGxheTogdHJ1ZSB9LFxyXG4gICAgICB7IGxlZnQ6ICdcXFxcYmVnaW57YWxpZ259JywgcmlnaHQ6ICdcXFxcZW5ke2FsaWdufScsIGRpc3BsYXk6IHRydWUgfSxcclxuICAgICAgeyBsZWZ0OiAnXFxcXGJlZ2lue2FsaWduYXR9JywgcmlnaHQ6ICdcXFxcZW5ke2FsaWduYXR9JywgZGlzcGxheTogdHJ1ZSB9LFxyXG4gICAgICB7IGxlZnQ6ICdcXFxcYmVnaW57Z2F0aGVyfScsIHJpZ2h0OiAnXFxcXGVuZHtnYXRoZXJ9JywgZGlzcGxheTogdHJ1ZSB9LFxyXG4gICAgICB7IGxlZnQ6ICdcXFxcYmVnaW57Q0R9JywgcmlnaHQ6ICdcXFxcZW5ke0NEfScsIGRpc3BsYXk6IHRydWUgfSxcclxuICAgICAgeyBsZWZ0OiAnXFxcXFsnLCByaWdodDogJ1xcXFxdJywgZGlzcGxheTogdHJ1ZSB9LFxyXG4gICAgXSxcclxuICB9O1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IERFRkFVTFRfTUVSTUFJRF9PUFRJT05TOiBNZXJtYWlkQVBJLkNvbmZpZyA9IHtcclxuICAgIHN0YXJ0T25Mb2FkOiBmYWxzZSxcclxuICB9O1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IERFRkFVTFRfQ0xJUEJPQVJEX09QVElPTlM6IENsaXBib2FyZE9wdGlvbnMgPSB7XHJcbiAgICBidXR0b25Db21wb25lbnQ6IHVuZGVmaW5lZCxcclxuICB9O1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IERFRkFVTFRfUEFSU0VfT1BUSU9OUzogUGFyc2VPcHRpb25zID0ge1xyXG4gICAgZGVjb2RlSHRtbDogZmFsc2UsXHJcbiAgICBpbmxpbmU6IGZhbHNlLFxyXG4gICAgZW1vamk6IGZhbHNlLFxyXG4gICAgbWVybWFpZDogZmFsc2UsXHJcbiAgICBtYXJrZWRPcHRpb25zOiB1bmRlZmluZWQsXHJcbiAgICBkaXNhYmxlU2FuaXRpemVyOiBmYWxzZSxcclxuICB9O1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IERFRkFVTFRfUkVOREVSX09QVElPTlM6IFJlbmRlck9wdGlvbnMgPSB7XHJcbiAgICBjbGlwYm9hcmQ6IGZhbHNlLFxyXG4gICAgY2xpcGJvYXJkT3B0aW9uczogdW5kZWZpbmVkLFxyXG4gICAga2F0ZXg6IGZhbHNlLFxyXG4gICAga2F0ZXhPcHRpb25zOiB1bmRlZmluZWQsXHJcbiAgICBtZXJtYWlkOiBmYWxzZSxcclxuICAgIG1lcm1haWRPcHRpb25zOiB1bmRlZmluZWQsXHJcbiAgfTtcclxuXHJcbiAgcHJpdmF0ZSBfb3B0aW9uczogTWFya2VkT3B0aW9ucyB8IHVuZGVmaW5lZDtcclxuXHJcbiAgZ2V0IG9wdGlvbnMoKTogTWFya2VkT3B0aW9ucyB7IHJldHVybiB0aGlzLl9vcHRpb25zITsgfVxyXG4gIHNldCBvcHRpb25zKHZhbHVlOiBNYXJrZWRPcHRpb25zIHwgdW5kZWZpbmVkKSB7XHJcbiAgICB0aGlzLl9vcHRpb25zID0geyAuLi50aGlzLkRFRkFVTFRfTUFSS0VEX09QVElPTlMsIC4uLnZhbHVlIH07XHJcbiAgfVxyXG5cclxuICBnZXQgcmVuZGVyZXIoKTogTWFya2VkUmVuZGVyZXIgeyByZXR1cm4gdGhpcy5vcHRpb25zLnJlbmRlcmVyITsgfVxyXG4gIHNldCByZW5kZXJlcih2YWx1ZTogTWFya2VkUmVuZGVyZXIpIHtcclxuICAgIHRoaXMub3B0aW9ucy5yZW5kZXJlciA9IHZhbHVlO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBfcmVsb2FkJCA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XHJcbiAgcmVhZG9ubHkgcmVsb2FkJCA9IHRoaXMuX3JlbG9hZCQuYXNPYnNlcnZhYmxlKCk7XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgQEluamVjdChDTElQQk9BUkRfT1BUSU9OUykgQE9wdGlvbmFsKCkgcHJpdmF0ZSBjbGlwYm9hcmRPcHRpb25zOiBDbGlwYm9hcmRPcHRpb25zLFxyXG4gICAgQEluamVjdChNQVJLRURfRVhURU5TSU9OUykgQE9wdGlvbmFsKCkgcHJpdmF0ZSBleHRlbnNpb25zOiBNYXJrZWRFeHRlbnNpb25bXSxcclxuICAgIEBJbmplY3QoTUFSS0VEX09QVElPTlMpIEBPcHRpb25hbCgpIG9wdGlvbnM6IE1hcmtlZE9wdGlvbnMsXHJcbiAgICBASW5qZWN0KFBMQVRGT1JNX0lEKSBwcml2YXRlIHBsYXRmb3JtOiBPYmplY3QsXHJcbiAgICBASW5qZWN0KFNFQ1VSSVRZX0NPTlRFWFQpIHByaXZhdGUgc2VjdXJpdHlDb250ZXh0OiBTZWN1cml0eUNvbnRleHQsXHJcbiAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQsXHJcbiAgICBwcml2YXRlIHNhbml0aXplcjogRG9tU2FuaXRpemVyLFxyXG4gICkge1xyXG4gICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcclxuICB9XHJcblxyXG4gIHBhcnNlKG1hcmtkb3duOiBzdHJpbmcsIHBhcnNlT3B0aW9uczogUGFyc2VPcHRpb25zID0gdGhpcy5ERUZBVUxUX1BBUlNFX09QVElPTlMpOiBzdHJpbmcgfCBQcm9taXNlPHN0cmluZz4ge1xyXG4gICAgY29uc3Qge1xyXG4gICAgICBkZWNvZGVIdG1sLFxyXG4gICAgICBpbmxpbmUsXHJcbiAgICAgIGVtb2ppLFxyXG4gICAgICBtZXJtYWlkLFxyXG4gICAgICBkaXNhYmxlU2FuaXRpemVyLFxyXG4gICAgfSA9IHBhcnNlT3B0aW9ucztcclxuXHJcbiAgICBjb25zdCBtYXJrZWRPcHRpb25zID0ge1xyXG4gICAgICAuLi50aGlzLm9wdGlvbnMsXHJcbiAgICAgIC4uLnBhcnNlT3B0aW9ucy5tYXJrZWRPcHRpb25zLFxyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCByZW5kZXJlciA9IG1hcmtlZE9wdGlvbnMucmVuZGVyZXIgfHwgdGhpcy5yZW5kZXJlciB8fCBuZXcgUmVuZGVyZXIoKTtcclxuXHJcbiAgICBpZiAodGhpcy5leHRlbnNpb25zKSB7XHJcbiAgICAgIHRoaXMucmVuZGVyZXIgPSB0aGlzLmV4dGVuZHNSZW5kZXJlckZvckV4dGVuc2lvbnMocmVuZGVyZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChtZXJtYWlkKSB7XHJcbiAgICAgIHRoaXMucmVuZGVyZXIgPSB0aGlzLmV4dGVuZHNSZW5kZXJlckZvck1lcm1haWQocmVuZGVyZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHRyaW1tZWQgPSB0aGlzLnRyaW1JbmRlbnRhdGlvbihtYXJrZG93bik7XHJcbiAgICBjb25zdCBkZWNvZGVkID0gZGVjb2RlSHRtbCA/IHRoaXMuZGVjb2RlSHRtbCh0cmltbWVkKSA6IHRyaW1tZWQ7XHJcbiAgICBjb25zdCBlbW9qaWZpZWQgPSBlbW9qaSA/IHRoaXMucGFyc2VFbW9qaShkZWNvZGVkKSA6IGRlY29kZWQ7XHJcbiAgICBjb25zdCBtYXJrZWQgPSB0aGlzLnBhcnNlTWFya2VkKGVtb2ppZmllZCwgbWFya2VkT3B0aW9ucywgaW5saW5lKTtcclxuICAgIGNvbnN0IHNhbml0aXplZCA9IGRpc2FibGVTYW5pdGl6ZXIgPyBtYXJrZWQgOiB0aGlzLnNhbml0aXplci5zYW5pdGl6ZSh0aGlzLnNlY3VyaXR5Q29udGV4dCwgbWFya2VkKTtcclxuXHJcbiAgICByZXR1cm4gc2FuaXRpemVkIHx8ICcnO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVyKGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBvcHRpb25zOiBSZW5kZXJPcHRpb25zID0gdGhpcy5ERUZBVUxUX1JFTkRFUl9PUFRJT05TLCB2aWV3Q29udGFpbmVyUmVmPzogVmlld0NvbnRhaW5lclJlZik6IHZvaWQge1xyXG4gICAgY29uc3Qge1xyXG4gICAgICBjbGlwYm9hcmQsXHJcbiAgICAgIGNsaXBib2FyZE9wdGlvbnMsXHJcbiAgICAgIGthdGV4LFxyXG4gICAgICBrYXRleE9wdGlvbnMsXHJcbiAgICAgIG1lcm1haWQsXHJcbiAgICAgIG1lcm1haWRPcHRpb25zLFxyXG4gICAgfSA9IG9wdGlvbnM7XHJcblxyXG4gICAgaWYgKGthdGV4KSB7XHJcbiAgICAgIHRoaXMucmVuZGVyS2F0ZXgoZWxlbWVudCwge1xyXG4gICAgICAgIC4uLnRoaXMuREVGQVVMVF9LQVRFWF9PUFRJT05TLFxyXG4gICAgICAgIC4uLmthdGV4T3B0aW9ucyxcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBpZiAobWVybWFpZCkge1xyXG4gICAgICB0aGlzLnJlbmRlck1lcm1haWQoZWxlbWVudCwge1xyXG4gICAgICAgIC4uLnRoaXMuREVGQVVMVF9NRVJNQUlEX09QVElPTlMsXHJcbiAgICAgICAgLi4ubWVybWFpZE9wdGlvbnMsXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgaWYgKGNsaXBib2FyZCkge1xyXG4gICAgICB0aGlzLnJlbmRlckNsaXBib2FyZChlbGVtZW50LCB2aWV3Q29udGFpbmVyUmVmLCB7XHJcbiAgICAgICAgLi4udGhpcy5ERUZBVUxUX0NMSVBCT0FSRF9PUFRJT05TLFxyXG4gICAgICAgIC4uLnRoaXMuY2xpcGJvYXJkT3B0aW9ucyxcclxuICAgICAgICAuLi5jbGlwYm9hcmRPcHRpb25zLFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmhpZ2hsaWdodChlbGVtZW50KTtcclxuICB9XHJcblxyXG4gIHJlbG9hZCgpOiB2b2lkIHtcclxuICAgIHRoaXMuX3JlbG9hZCQubmV4dCgpO1xyXG4gIH1cclxuXHJcbiAgZ2V0U291cmNlKHNyYzogc3RyaW5nKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcclxuICAgIGlmICghdGhpcy5odHRwKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvclNyY1dpdGhvdXRIdHRwQ2xpZW50KTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmh0dHBcclxuICAgICAgLmdldChzcmMsIHsgcmVzcG9uc2VUeXBlOiAndGV4dCcgfSlcclxuICAgICAgLnBpcGUobWFwKG1hcmtkb3duID0+IHRoaXMuaGFuZGxlRXh0ZW5zaW9uKHNyYywgbWFya2Rvd24pKSk7XHJcbiAgfVxyXG5cclxuICBoaWdobGlnaHQoZWxlbWVudD86IEVsZW1lbnQgfCBEb2N1bWVudCk6IHZvaWQge1xyXG4gICAgaWYgKCFpc1BsYXRmb3JtQnJvd3Nlcih0aGlzLnBsYXRmb3JtKSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIFByaXNtID09PSAndW5kZWZpbmVkJyB8fCB0eXBlb2YgUHJpc20uaGlnaGxpZ2h0QWxsVW5kZXIgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICghZWxlbWVudCkge1xyXG4gICAgICBlbGVtZW50ID0gZG9jdW1lbnQ7XHJcbiAgICB9XHJcbiAgICBjb25zdCBub0xhbmd1YWdlRWxlbWVudHMgPSBlbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ3ByZSBjb2RlOm5vdChbY2xhc3MqPVwibGFuZ3VhZ2UtXCJdKScpO1xyXG4gICAgQXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbChub0xhbmd1YWdlRWxlbWVudHMsICh4OiBFbGVtZW50KSA9PiB4LmNsYXNzTGlzdC5hZGQoJ2xhbmd1YWdlLW5vbmUnKSk7XHJcbiAgICBQcmlzbS5oaWdobGlnaHRBbGxVbmRlcihlbGVtZW50KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZGVjb2RlSHRtbChodG1sOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgaWYgKCFpc1BsYXRmb3JtQnJvd3Nlcih0aGlzLnBsYXRmb3JtKSkge1xyXG4gICAgICByZXR1cm4gaHRtbDtcclxuICAgIH1cclxuICAgIGNvbnN0IHRleHRhcmVhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGV4dGFyZWEnKTtcclxuICAgIHRleHRhcmVhLmlubmVySFRNTCA9IGh0bWw7XHJcbiAgICByZXR1cm4gdGV4dGFyZWEudmFsdWU7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGV4dGVuZHNSZW5kZXJlckZvckV4dGVuc2lvbnMocmVuZGVyZXI6IFJlbmRlcmVyKTogUmVuZGVyZXIge1xyXG4gICAgY29uc3QgZXh0ZW5kZWRSZW5kZXJlciA9IHJlbmRlcmVyIGFzIEV4dGVuZGVkUmVuZGVyZXI7XHJcbiAgICBpZiAoZXh0ZW5kZWRSZW5kZXJlci7JtU5neE1hcmtkb3duUmVuZGVyZXJFeHRlbmRlZEZvckV4dGVuc2lvbnMgPT09IHRydWUpIHtcclxuICAgICAgcmV0dXJuIHJlbmRlcmVyO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLmV4dGVuc2lvbnM/Lmxlbmd0aCA+IDApIHtcclxuICAgICAgbWFya2VkLnVzZSguLi50aGlzLmV4dGVuc2lvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIGV4dGVuZGVkUmVuZGVyZXIuybVOZ3hNYXJrZG93blJlbmRlcmVyRXh0ZW5kZWRGb3JFeHRlbnNpb25zID0gdHJ1ZTtcclxuXHJcbiAgICByZXR1cm4gcmVuZGVyZXI7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGV4dGVuZHNSZW5kZXJlckZvck1lcm1haWQocmVuZGVyZXI6IFJlbmRlcmVyKTogUmVuZGVyZXIge1xyXG4gICAgY29uc3QgZXh0ZW5kZWRSZW5kZXJlciA9IHJlbmRlcmVyIGFzIEV4dGVuZGVkUmVuZGVyZXI7XHJcbiAgICBpZiAoZXh0ZW5kZWRSZW5kZXJlci7JtU5neE1hcmtkb3duUmVuZGVyZXJFeHRlbmRlZEZvck1lcm1haWQgPT09IHRydWUpIHtcclxuICAgICAgcmV0dXJuIHJlbmRlcmVyO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvdW5ib3VuZC1tZXRob2RcclxuICAgIGNvbnN0IGRlZmF1bHRDb2RlID0gcmVuZGVyZXIuY29kZTtcclxuICAgIHJlbmRlcmVyLmNvZGUgPSBmdW5jdGlvbiAoY29kZTogc3RyaW5nLCBsYW5ndWFnZTogc3RyaW5nIHwgdW5kZWZpbmVkLCBpc0VzY2FwZWQ6IGJvb2xlYW4pIHtcclxuICAgICAgcmV0dXJuIGxhbmd1YWdlID09PSAnbWVybWFpZCdcclxuICAgICAgICA/IGA8ZGl2IGNsYXNzPVwibWVybWFpZFwiPiR7Y29kZX08L2Rpdj5gXHJcbiAgICAgICAgOiBkZWZhdWx0Q29kZS5jYWxsKHRoaXMsIGNvZGUsIGxhbmd1YWdlLCBpc0VzY2FwZWQpO1xyXG4gICAgfTtcclxuXHJcbiAgICBleHRlbmRlZFJlbmRlcmVyLsm1Tmd4TWFya2Rvd25SZW5kZXJlckV4dGVuZGVkRm9yTWVybWFpZCA9IHRydWU7XHJcblxyXG4gICAgcmV0dXJuIHJlbmRlcmVyO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBoYW5kbGVFeHRlbnNpb24oc3JjOiBzdHJpbmcsIG1hcmtkb3duOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgY29uc3QgdXJsUHJvdG9jb2xJbmRleCA9IHNyYy5sYXN0SW5kZXhPZignOi8vJyk7XHJcbiAgICBjb25zdCB1cmxXaXRob3V0UHJvdG9jb2wgPSB1cmxQcm90b2NvbEluZGV4ID4gLTFcclxuICAgICAgPyBzcmMuc3Vic3RyaW5nKHVybFByb3RvY29sSW5kZXggKyA0KVxyXG4gICAgICA6IHNyYztcclxuXHJcbiAgICBjb25zdCBsYXN0U2xhc2hJbmRleCA9IHVybFdpdGhvdXRQcm90b2NvbC5sYXN0SW5kZXhPZignLycpO1xyXG4gICAgY29uc3QgbGFzdFVybFNlZ21lbnQgPSBsYXN0U2xhc2hJbmRleCA+IC0xXHJcbiAgICAgID8gdXJsV2l0aG91dFByb3RvY29sLnN1YnN0cmluZyhsYXN0U2xhc2hJbmRleCArIDEpLnNwbGl0KCc/JylbMF1cclxuICAgICAgOiAnJztcclxuXHJcbiAgICBjb25zdCBsYXN0RG90SW5kZXggPSBsYXN0VXJsU2VnbWVudC5sYXN0SW5kZXhPZignLicpO1xyXG4gICAgY29uc3QgZXh0ZW5zaW9uID0gbGFzdERvdEluZGV4ID4gLTFcclxuICAgICAgPyBsYXN0VXJsU2VnbWVudC5zdWJzdHJpbmcobGFzdERvdEluZGV4ICsgMSlcclxuICAgICAgOiAnJztcclxuXHJcbiAgICByZXR1cm4gISFleHRlbnNpb24gJiYgZXh0ZW5zaW9uICE9PSAnbWQnXHJcbiAgICAgID8gJ2BgYCcgKyBleHRlbnNpb24gKyAnXFxuJyArIG1hcmtkb3duICsgJ1xcbmBgYCdcclxuICAgICAgOiBtYXJrZG93bjtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgcGFyc2VNYXJrZWQoaHRtbDogc3RyaW5nLCBtYXJrZWRPcHRpb25zOiBNYXJrZWRPcHRpb25zLCBpbmxpbmUgPSBmYWxzZSk6IHN0cmluZyB8IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgICBpZiAobWFya2VkT3B0aW9ucy5yZW5kZXJlcikge1xyXG4gICAgICAvLyBjbG9uZSByZW5kZXJlciBhbmQgcmVtb3ZlIGV4dGVuZGVkIGZsYWdzIG90aGVyd2lzZVxyXG4gICAgICAvLyBtYXJrZWQgdGhyb3dzIGFuIGVycm9yIHRoaW5raW5nIGl0IGlzIGEgcmVuZGVyZXIgcHJvcFxyXG4gICAgICBjb25zdCByZW5kZXJlciA9IHsgLi4ubWFya2VkT3B0aW9ucy5yZW5kZXJlciB9IGFzIFBhcnRpYWw8RXh0ZW5kZWRSZW5kZXJlcj47XHJcbiAgICAgIGRlbGV0ZSByZW5kZXJlci7JtU5neE1hcmtkb3duUmVuZGVyZXJFeHRlbmRlZEZvckV4dGVuc2lvbnM7XHJcbiAgICAgIGRlbGV0ZSByZW5kZXJlci7JtU5neE1hcmtkb3duUmVuZGVyZXJFeHRlbmRlZEZvck1lcm1haWQ7XHJcblxyXG4gICAgICAvLyByZW1vdmUgcmVuZGVyZXIgZnJvbSBtYXJrZWRPcHRpb25zIGJlY2F1c2UgaWYgcmVuZGVyZXIgaXNcclxuICAgICAgLy8gcGFzc2VkIHRvIG1hcmtlZC5wYXJzZSBtZXRob2QsIGl0IHdpbGwgaWdub3JlIGFsbCBleHRlbnNpb25zXHJcbiAgICAgIGRlbGV0ZSBtYXJrZWRPcHRpb25zLnJlbmRlcmVyO1xyXG5cclxuICAgICAgbWFya2VkLnVzZSh7IHJlbmRlcmVyIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBpbmxpbmVcclxuICAgICAgPyBtYXJrZWQucGFyc2VJbmxpbmUoaHRtbCwgbWFya2VkT3B0aW9ucylcclxuICAgICAgOiBtYXJrZWQucGFyc2UoaHRtbCwgbWFya2VkT3B0aW9ucyk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHBhcnNlRW1vamkoaHRtbDogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgIGlmICghaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybSkpIHtcclxuICAgICAgcmV0dXJuIGh0bWw7XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIGpveXBpeGVscyA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIGpveXBpeGVscy5zaG9ydG5hbWVUb1VuaWNvZGUgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvckpveVBpeGVsc05vdExvYWRlZCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gam95cGl4ZWxzLnNob3J0bmFtZVRvVW5pY29kZShodG1sKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgcmVuZGVyS2F0ZXgoZWxlbWVudDogSFRNTEVsZW1lbnQsIG9wdGlvbnM6IEthdGV4T3B0aW9ucyk6IHZvaWQge1xyXG4gICAgaWYgKCFpc1BsYXRmb3JtQnJvd3Nlcih0aGlzLnBsYXRmb3JtKSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIGthdGV4ID09PSAndW5kZWZpbmVkJyB8fCB0eXBlb2YgcmVuZGVyTWF0aEluRWxlbWVudCA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yS2F0ZXhOb3RMb2FkZWQpO1xyXG4gICAgfVxyXG4gICAgcmVuZGVyTWF0aEluRWxlbWVudChlbGVtZW50LCBvcHRpb25zKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgcmVuZGVyQ2xpcGJvYXJkKGVsZW1lbnQ6IEhUTUxFbGVtZW50LCB2aWV3Q29udGFpbmVyUmVmOiBWaWV3Q29udGFpbmVyUmVmIHwgdW5kZWZpbmVkLCBvcHRpb25zOiBDbGlwYm9hcmRSZW5kZXJPcHRpb25zKTogdm9pZCB7XHJcbiAgICBpZiAoIWlzUGxhdGZvcm1Ccm93c2VyKHRoaXMucGxhdGZvcm0pKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgQ2xpcGJvYXJkSlMgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvckNsaXBib2FyZE5vdExvYWRlZCk7XHJcbiAgICB9XHJcbiAgICBpZiAoIXZpZXdDb250YWluZXJSZWYpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yQ2xpcGJvYXJkVmlld0NvbnRhaW5lclJlcXVpcmVkKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7XHJcbiAgICAgIGJ1dHRvbkNvbXBvbmVudCxcclxuICAgICAgYnV0dG9uVGVtcGxhdGUsXHJcbiAgICB9ID0gb3B0aW9ucztcclxuXHJcbiAgICAvLyB0YXJnZXQgZXZlcnkgPHByZT4gZWxlbWVudHNcclxuICAgIGNvbnN0IHByZUVsZW1lbnRzID0gZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCdwcmUnKTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcHJlRWxlbWVudHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgY29uc3QgcHJlRWxlbWVudCA9IHByZUVsZW1lbnRzLml0ZW0oaSk7XHJcblxyXG4gICAgICAvLyBjcmVhdGUgPHByZT4gd3JhcHBlciBlbGVtZW50XHJcbiAgICAgIGNvbnN0IHByZVdyYXBwZXJFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgIHByZVdyYXBwZXJFbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gJ3JlbGF0aXZlJztcclxuICAgICAgcHJlRWxlbWVudC5wYXJlbnROb2RlIS5pbnNlcnRCZWZvcmUocHJlV3JhcHBlckVsZW1lbnQsIHByZUVsZW1lbnQpO1xyXG4gICAgICBwcmVXcmFwcGVyRWxlbWVudC5hcHBlbmRDaGlsZChwcmVFbGVtZW50KTtcclxuXHJcbiAgICAgIC8vIGNyZWF0ZSB0b29sYmFyIGVsZW1lbnRcclxuICAgICAgY29uc3QgdG9vbGJhcldyYXBwZXJFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgIHRvb2xiYXJXcmFwcGVyRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdtYXJrZG93bi1jbGlwYm9hcmQtdG9vbGJhcicpO1xyXG4gICAgICB0b29sYmFyV3JhcHBlckVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xyXG4gICAgICB0b29sYmFyV3JhcHBlckVsZW1lbnQuc3R5bGUudG9wID0gJy41ZW0nO1xyXG4gICAgICB0b29sYmFyV3JhcHBlckVsZW1lbnQuc3R5bGUucmlnaHQgPSAnLjVlbSc7XHJcbiAgICAgIHRvb2xiYXJXcmFwcGVyRWxlbWVudC5zdHlsZS56SW5kZXggPSAnMSc7XHJcbiAgICAgIHByZVdyYXBwZXJFbGVtZW50Lmluc2VydEFkamFjZW50RWxlbWVudCgnYmVmb3JlZW5kJywgdG9vbGJhcldyYXBwZXJFbGVtZW50KTtcclxuXHJcbiAgICAgIC8vIHJlZ2lzdGVyIGxpc3RlbmVyIHRvIHNob3cvaGlkZSB0b29sYmFyXHJcbiAgICAgIHByZVdyYXBwZXJFbGVtZW50Lm9ubW91c2VlbnRlciA9ICgpID0+IHRvb2xiYXJXcmFwcGVyRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdob3ZlcicpO1xyXG4gICAgICBwcmVXcmFwcGVyRWxlbWVudC5vbm1vdXNlbGVhdmUgPSAoKSA9PiB0b29sYmFyV3JhcHBlckVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnaG92ZXInKTtcclxuXHJcbiAgICAgIC8vIGRlY2xhcmUgZW1iZWRkZWRWaWV3UmVmIGhvbGRpbmcgdmFyaWFibGVcclxuICAgICAgbGV0IGVtYmVkZGVkVmlld1JlZjogRW1iZWRkZWRWaWV3UmVmPHVua25vd24+O1xyXG5cclxuICAgICAgLy8gdXNlIHByb3ZpZGVkIGNvbXBvbmVudCB2aWEgaW5wdXQgcHJvcGVydHlcclxuICAgICAgLy8gb3IgcHJvdmlkZWQgdmlhIENsaXBib2FyZE9wdGlvbnMgcHJvdmlkZXJcclxuICAgICAgaWYgKGJ1dHRvbkNvbXBvbmVudCkge1xyXG4gICAgICAgIGNvbnN0IGNvbXBvbmVudFJlZiA9IHZpZXdDb250YWluZXJSZWYuY3JlYXRlQ29tcG9uZW50KGJ1dHRvbkNvbXBvbmVudCk7XHJcbiAgICAgICAgZW1iZWRkZWRWaWV3UmVmID0gY29tcG9uZW50UmVmLmhvc3RWaWV3IGFzIEVtYmVkZGVkVmlld1JlZjx1bmtub3duPjtcclxuICAgICAgICBjb21wb25lbnRSZWYuY2hhbmdlRGV0ZWN0b3JSZWYubWFya0ZvckNoZWNrKCk7XHJcbiAgICAgIH1cclxuICAgICAgLy8gdXNlIHByb3ZpZGVkIHRlbXBsYXRlIHZpYSBpbnB1dCBwcm9wZXJ0eVxyXG4gICAgICBlbHNlIGlmIChidXR0b25UZW1wbGF0ZSkge1xyXG4gICAgICAgIGVtYmVkZGVkVmlld1JlZiA9IHZpZXdDb250YWluZXJSZWYuY3JlYXRlRW1iZWRkZWRWaWV3KGJ1dHRvblRlbXBsYXRlKTtcclxuICAgICAgfVxyXG4gICAgICAvLyB1c2UgZGVmYXVsdCBjb21wb25lbnRcclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgY29uc3QgY29tcG9uZW50UmVmID0gdmlld0NvbnRhaW5lclJlZi5jcmVhdGVDb21wb25lbnQoQ2xpcGJvYXJkQnV0dG9uQ29tcG9uZW50KTtcclxuICAgICAgICBlbWJlZGRlZFZpZXdSZWYgPSBjb21wb25lbnRSZWYuaG9zdFZpZXcgYXMgRW1iZWRkZWRWaWV3UmVmPHVua25vd24+O1xyXG4gICAgICAgIGNvbXBvbmVudFJlZi5jaGFuZ2VEZXRlY3RvclJlZi5tYXJrRm9yQ2hlY2soKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gZGVjbGFyZSBjbGlwYm9hcmQgaW5zdGFuY2UgdmFyaWFibGVcclxuICAgICAgbGV0IGNsaXBib2FyZEluc3RhbmNlOiB0eXBlb2YgQ2xpcGJvYXJkSlM7XHJcblxyXG4gICAgICAvLyBhdHRhY2ggY2xpcGJvYXJkLmpzIHRvIHJvb3Qgbm9kZVxyXG4gICAgICBlbWJlZGRlZFZpZXdSZWYucm9vdE5vZGVzLmZvckVhY2goKG5vZGU6IEhUTUxFbGVtZW50KSA9PiB7XHJcbiAgICAgICAgdG9vbGJhcldyYXBwZXJFbGVtZW50LmFwcGVuZENoaWxkKG5vZGUpO1xyXG4gICAgICAgIGNsaXBib2FyZEluc3RhbmNlID0gbmV3IENsaXBib2FyZEpTKG5vZGUsIHsgdGV4dDogKCkgPT4gcHJlRWxlbWVudC5pbm5lclRleHQgfSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gZGVzdHJveSBjbGlwYm9hcmQgaW5zdGFuY2Ugd2hlbiB2aWV3IGlzIGRlc3Ryb3llZFxyXG4gICAgICBlbWJlZGRlZFZpZXdSZWYub25EZXN0cm95KCgpID0+IGNsaXBib2FyZEluc3RhbmNlLmRlc3Ryb3koKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHJlbmRlck1lcm1haWQoZWxlbWVudDogSFRNTEVsZW1lbnQsIG9wdGlvbnM6IE1lcm1haWRBUEkuQ29uZmlnID0gdGhpcy5ERUZBVUxUX01FUk1BSURfT1BUSU9OUyk6IHZvaWQge1xyXG4gICAgaWYgKCFpc1BsYXRmb3JtQnJvd3Nlcih0aGlzLnBsYXRmb3JtKSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIG1lcm1haWQgPT09ICd1bmRlZmluZWQnIHx8IHR5cGVvZiBtZXJtYWlkLmluaXRpYWxpemUgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvck1lcm1haWROb3RMb2FkZWQpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgbWVybWFpZEVsZW1lbnRzID0gZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsPEhUTUxFbGVtZW50PignLm1lcm1haWQnKTtcclxuICAgIGlmIChtZXJtYWlkRWxlbWVudHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIG1lcm1haWQuaW5pdGlhbGl6ZShvcHRpb25zKTtcclxuICAgIG1lcm1haWQucnVuKHsgbm9kZXM6IG1lcm1haWRFbGVtZW50cyB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgdHJpbUluZGVudGF0aW9uKG1hcmtkb3duOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgaWYgKCFtYXJrZG93bikge1xyXG4gICAgICByZXR1cm4gJyc7XHJcbiAgICB9XHJcbiAgICBsZXQgaW5kZW50U3RhcnQ6IG51bWJlcjtcclxuICAgIHJldHVybiBtYXJrZG93blxyXG4gICAgICAuc3BsaXQoJ1xcbicpXHJcbiAgICAgIC5tYXAobGluZSA9PiB7XHJcbiAgICAgICAgbGV0IGxpbmVJZGVudFN0YXJ0ID0gaW5kZW50U3RhcnQ7XHJcbiAgICAgICAgaWYgKGxpbmUubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgbGluZUlkZW50U3RhcnQgPSBpc05hTihsaW5lSWRlbnRTdGFydClcclxuICAgICAgICAgICAgPyBsaW5lLnNlYXJjaCgvXFxTfCQvKVxyXG4gICAgICAgICAgICA6IE1hdGgubWluKGxpbmUuc2VhcmNoKC9cXFN8JC8pLCBsaW5lSWRlbnRTdGFydCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpc05hTihpbmRlbnRTdGFydCkpIHtcclxuICAgICAgICAgIGluZGVudFN0YXJ0ID0gbGluZUlkZW50U3RhcnQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBsaW5lSWRlbnRTdGFydFxyXG4gICAgICAgICAgPyBsaW5lLnN1YnN0cmluZyhsaW5lSWRlbnRTdGFydClcclxuICAgICAgICAgIDogbGluZTtcclxuICAgICAgfSkuam9pbignXFxuJyk7XHJcbiAgfVxyXG59XHJcbiJdfQ==